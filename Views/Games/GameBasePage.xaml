<Page x:Class="SGSClient.Views.GameBasePage" xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:behaviors="using:SGSClient.Behaviors" xmlns:d="http://schemas.microsoft.com/expression/blend/2008" xmlns:helpers="using:SGSClient.Helpers" xmlns:local="using:SGSClient.Models" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" behaviors:NavigationViewHeaderBehavior.HeaderMode="Never" mc:Ignorable="d">

    <Grid Background="{ThemeResource AcrylicBackgroundFillColorDefaultBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="250" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!--  GŁÓWNY HEADER Z TŁEM  -->
        <Grid Grid.Row="0" Height="250">
            <!--  Tło: gradient + duże logo  -->
            <Grid>
                <Grid.Background>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                        <GradientStop Offset="0" Color="#AA000000" />
                        <GradientStop Offset="1" Color="#66000000" />
                    </LinearGradientBrush>
                </Grid.Background>
                <Image Height="400" HorizontalAlignment="Center" VerticalAlignment="Center" Opacity="0.12" Source="{Binding GameLogo.ImageSource}" Stretch="UniformToFill" />
            </Grid>

            <!--  Właściwy content nagłówka  -->
            <Grid Margin="30,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="220" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="250" />
                </Grid.ColumnDefinitions>

                <!--  Logo  -->
                <StackPanel Grid.Column="0" VerticalAlignment="Center">
                    <Border Width="160" Height="160" Background="#222" CornerRadius="80">
                        <Image Width="120" Height="120" HorizontalAlignment="Center" VerticalAlignment="Center" Source="{Binding GameLogo.ImageSource}" Stretch="Uniform" />
                    </Border>
                </StackPanel>

                <!--  Dane gry  -->
                <StackPanel Grid.Column="1" Margin="25,0,0,0" VerticalAlignment="Center">
                    <TextBlock FontSize="34" FontWeight="Bold" Foreground="White" Text="{Binding GameName}" />
                    <TextBlock Margin="0,6,0,0" FontSize="16" Foreground="LightGray" Text="{Binding GameDeveloper}" />
                    <TextBlock MaxHeight="60" Margin="0,10,0,0" FontSize="15" Foreground="White" Text="{Binding GameDescription}" TextTrimming="CharacterEllipsis" TextWrapping="Wrap" />
                </StackPanel>

                <!--  Panel akcji + oceny  -->
                <StackPanel Grid.Column="2" HorizontalAlignment="Right" VerticalAlignment="Center" Spacing="10">
                    <!--  Sekcja OCENY w headerze  -->
                    <StackPanel Margin="0,0,0,8" HorizontalAlignment="Right" Orientation="Horizontal">
                        <SymbolIcon Width="24" Height="24" VerticalAlignment="Center" Foreground="Gold" Symbol="Favorite" />
                        <TextBlock Margin="8,0,0,0" VerticalAlignment="Center" FontSize="30" FontWeight="Bold" Foreground="White" Text="{Binding AvgRating}" />
                        <TextBlock Margin="4,0,0,0" VerticalAlignment="Center" FontSize="16" Foreground="Gray" Text="/ 5" />
                        <TextBlock Margin="8,0,0,0" VerticalAlignment="Bottom" FontSize="13" Foreground="Gray">
                            <Run Text="(" />
                            <Run Text="{Binding RatingCount}" />
                            <Run Text=" ocen)" />
                        </TextBlock>
                    </StackPanel>
                    <!--  Przycisk pobrania, aktualizacja i odinstalowanie  -->
                    <Button x:Name="PlayButton" Width="180" Height="44" Background="#0078D7" Click="PlayButton_Click" Content="Pobierz" FontWeight="SemiBold" Foreground="White" />
                    <Button x:Name="CheckUpdateButton" Width="180" Height="40" Click="UpdateButton_Click" Content="Aktualizuj" />
                    <HyperlinkButton x:Name="UninstallButton" Click="UninstallButton_Click" Content="Odinstaluj" FontSize="14" Foreground="LightGray" />
                </StackPanel>
            </Grid>
        </Grid>

        <!--  TREŚĆ  -->
        <ScrollViewer Grid.Row="1">
            <StackPanel>

                <!--  Zrzuty ekranu  -->
                <ScrollViewer Margin="25,10" HorizontalScrollBarVisibility="Auto" HorizontalScrollMode="Auto" VerticalScrollMode="Disabled">
                    <ItemsRepeater ItemsSource="{Binding GameImages}">
                        <ItemsRepeater.Layout>
                            <StackLayout Orientation="Horizontal" Spacing="12" />
                        </ItemsRepeater.Layout>
                        <ItemsRepeater.ItemTemplate>
                            <DataTemplate>
                                <Border Background="#111" CornerRadius="10">
                                    <Image Width="320" Height="200" Source="{Binding ImageSource}" Stretch="UniformToFill" />
                                </Border>
                            </DataTemplate>
                        </ItemsRepeater.ItemTemplate>
                    </ItemsRepeater>
                </ScrollViewer>

                <!--  Sekcje kartowe  -->
                <Border Margin="25,10" Padding="16" Background="{ThemeResource AcrylicInAppFillColorDefaultBrush}" CornerRadius="14">
                    <StackPanel>
                        <TextBlock FontSize="21" FontWeight="SemiBold" Text="Opis" />
                        <Rectangle Height="1" Margin="0,8" Fill="{ThemeResource ControlElevationBorderBrush}" />
                        <TextBlock FontSize="15" Text="{Binding GameDescription}" TextWrapping="Wrap" />
                    </StackPanel>
                </Border>

                <Border Margin="25,10" Padding="16" Background="{ThemeResource AcrylicInAppFillColorDefaultBrush}" CornerRadius="14" Visibility="{Binding IsHardwareRequirementsVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <StackPanel>
                        <TextBlock FontSize="21" FontWeight="SemiBold" Text="Wymagania systemowe" />
                        <Rectangle Height="1" Margin="0,8" Fill="{ThemeResource ControlElevationBorderBrush}" />
                        <TextBlock FontSize="15" Text="{Binding HardwareRequirements}" />
                    </StackPanel>
                </Border>

                <!--  Oceny i recenzje  -->
                <Border Margin="25,10" Padding="16" Background="{ThemeResource AcrylicInAppFillColorDefaultBrush}" CornerRadius="14" Visibility="Collapsed">
                    <StackPanel>
                        <TextBlock FontSize="21" FontWeight="SemiBold" Text="Oceny i recenzje" />
                        <Rectangle Height="1" Margin="0,8" Fill="{ThemeResource ControlElevationBorderBrush}" />

                        <Grid Margin="0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <!--  Średnia  -->
                            <StackPanel Grid.Column="0" Margin="0,0,25,0" VerticalAlignment="Center">
                                <TextBlock FontSize="44" FontWeight="Bold" Text="{Binding AvgRating}" />
                                <TextBlock FontSize="13" Foreground="Gray">
                                    <Run Text="Ocen: " />
                                    <Run Text="{Binding RatingCount}" />
                                </TextBlock>
                            </StackPanel>
                            <!--  Gwiazdki  -->
                            <StackPanel Grid.Column="1" VerticalAlignment="Center" Spacing="5">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Width="22" Text="5" />
                                    <ProgressBar Width="220" Height="13" Value="{Binding Count5}" />
                                </StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Width="22" Text="4" />
                                    <ProgressBar Width="220" Height="13" Value="{Binding Count4}" />
                                </StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Width="22" Text="3" />
                                    <ProgressBar Width="220" Height="13" Value="{Binding Count3}" />
                                </StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Width="22" Text="2" />
                                    <ProgressBar Width="220" Height="13" Value="{Binding Count2}" />
                                </StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Width="22" Text="1" />
                                    <ProgressBar Width="220" Height="13" Value="{Binding Count1}" />
                                </StackPanel>
                            </StackPanel>
                        </Grid>

                        <!--  Lista recenzji  -->
                        <ListView Margin="0,10,0,0" ItemsSource="{x:Bind ViewModel.Ratings}">
                            <ListView.ItemTemplate>
                                <DataTemplate x:DataType="local:GameRating">
                                    <StackPanel Margin="0,0,0,14">
                                        <TextBlock FontSize="16" FontWeight="Bold" Text="{x:Bind Title}" />
                                        <RatingControl IsReadOnly="True" Value="{x:Bind Rating}" />
                                        <TextBlock Margin="0,2,0,0" FontSize="14" Text="{x:Bind Review}" TextWrapping="Wrap" />
                                        <TextBlock FontSize="12" Foreground="Gray" Text="{x:Bind Author}" />
                                    </StackPanel>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                        <HyperlinkButton Margin="0,10,0,0" HorizontalAlignment="Left" Click="ShowAllReviewsButton_Click" Content="Wyświetl wszystkie recenzje" />
                    </StackPanel>
                </Border>

            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>
